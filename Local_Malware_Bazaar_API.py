import os


def download_List():
    import requests
    name = r"D:\Malware List\testfile.zip"
    folder = r"D:\Malware List"
    file = requests.get("https://bazaar.abuse.ch/export/txt/sha256/full/")
    with open(name, "wb") as f:
        f.write(file.content)
    from zipfile import ZipFile
    with ZipFile(name, "r") as zip:
        zip.extractall(folder)
    for item in os.listdir(folder):
        if item.endswith(".txt"):
            file = open(folder + "\\" + item).readlines()
            new_File = []
            for i, line in enumerate(file):
                if i < 9 or "entries" in line.replace(":", "").split(" "):
                    continue
                new_File.append(line)
            with open(folder + "\\" + item, "w") as f:
                for item in new_File:
                    f.write(str(item))
    os.remove(name)


def check_List(hashed_item):
    #
    # hashed_item is ALWAYS Sha256
    #
    files = []
    pfad = r"D:\Malware List"
    for file in os.listdir(pfad):
        if not file.endswith(".txt"):
            continue
        if os.path.isdir(pfad + "\\" + file):
            continue
        f = open(pfad + "\\" + file)
        if len(files) == 0:
            files = f
        else:
            files.extend(f)
    files = list(set(files))
    for entries in files:
        if hashed_item == entries:
            return True
        else:
            continue
    return False


def Test_check():
    import hashlib
    path = r"D:\Malware List"
    for file in os.listdir(path):
        if os.path.isdir(path + "\\" + file):
            continue
        with open(path + "\\" + file, "rb") as f:
            hash = hashlib.sha256(f.read()).hexdigest()
            Malware = check_List(hash)
            print(str(file) + " --> " + str(Malware))
            if Malware:
                print("ITS MALWARE!!!!!!!!!!!!!!!!!!!!!!!\n\n\n\n\n Its Malware!!!")
